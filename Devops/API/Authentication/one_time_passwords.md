~~~html
One-time passwords (OTPs) are a type of authentication mechanism in which a password is generated for a single use, and is then discarded. They are commonly used as a second factor of authentication, in addition to a traditional username and password. OTPs are designed to be used only once, and can be delivered to the user in various ways such as email, SMS, or generated by a hardware token.
~~~
- Here's an example of how one-time password (OTP) could be implemented in a Ruby on Rails application:

~~~ruby
# In the controller handling the login request:
def create
  user = User.find_by(email: params[:email])
  if user&.authenticate(params[:password])
    if user.otp_secret
      user.otp_secret = ROTP::Base32.random_base32
    end
    otp = ROTP::TOTP.new(user.otp_secret)
    user.save
    UserMailer.send_otp(user, otp.now).deliver
    flash[:notice] = "An OTP has been sent to your email. Please enter it to proceed."
    redirect_to otp_verification_path
  else
    flash[:danger] = "Invalid email or password"
    render :new
  end
end

# In the controller handling the OTP verification request
def verify
  user = User.find_by(email: params[:email])
  if user
    otp = ROTP::TOTP.new(user.otp_secret)
    if otp.verify(params[:otp])
      session[:user_id] = user.id
      redirect_to root_path
    else
      flash[:danger] = "Invalid OTP"
      render :verify
    end
  else
    flash[:danger] = "Invalid email"
    render :verify
  end
end
~~~

~~~html
This example uses the ROTP gem to generate and validate One-time password. It uses the time-based one-time password (TOTP) algorithm, which is based on the current time, so the password changes every 30 seconds.

In the first part of the code, after successful login, the application will check if user has an OTP secret or not. If not it will generate a new random OTP secret and send it to user's email address via an emailer. Once email is sent user will be redirected to enter the OTP.

In the second part of the code, once the user enters the OTP, the application will validate the OTP and if it's valid, it will set the session[:user_id] equal to user.id and redirect to root_path.

You can also set expiration time for the OTP and also can use different algorithms like HOTP(HMAC based one time password) for generating OTP.

It's important to note that OTP is just one way of implementing multi-factor authentication, but it is a widely used and secure way to ensure the security of the system by providing an additional level of verification.
~~~


### Pros
~~~html
1. Adds an extra layer of protection.
2. No danger that a stolen password can be used for multiple sites or services that also implement OTPs.
~~~

### Cons
~~~html
1. You need to store the seed used for generating OTPs.
2. OTP agents like Google Authenticator are difficult to set up again if you lose the recovery code.
3. Problems arise when the trusted device is not available (dead battery, network error, etc.). Because of this, a backup device is typically required which adds an additional attack vector.
~~~
